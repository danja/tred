<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Wikidata named things</title>

    <script src="js/lib/jquery-3.6.0.min.js"></script>

    <script src="js/config.js"></script>

    <script src="js/utils.js"></script>
    <script src="js/sparql-connector.js"></script>

    <script src="js/sparql-templates.js"></script>
    <script src="js/html-templates.js"></script>

    <script type="text/javascript" language="javascript">
      function makeList (linkArray) {
        var list = '<ul>'

        for (var i = 0; i < linkArray.length; i++) {
          console.log('linkArray[i] = ' + JSON.stringify(linkArray[i]))
          //    list += templater(linkTemplate, linkArray[i])
          list += linkHT(linkArray[i].link)
        }

        return list + '</ul>'
      }

      function wikidatanameHandler (json) {
        var bindings = json.results.bindings

        var links = []
        for (var i = 0; i < bindings.length; i++) {
          links.push({ link: bindings[i].link.value })
        }

        var list = makeList(links)
        $('#links').replaceWith(list)
      }

      function classesHandler (json) {
        var bindings = json.results.bindings
        console.log(JSON.stringify(bindings))

        var classes = []
        for (var i = 0; i < bindings.length; i++) {
          //  links.push({ link: bindings[i].link.value })
          console.log(bindings[i].label.value + ' : ' + bindings[i].class.value)
        }

        // var list = makeList(links)
        // $('#links').replaceWith(list)
      }

      function getClasses () {
        submitQuery(classesQT(), classesHandler)
      }

      function getNamed (name) {
        var wikidataNameSparql = wikidatanameQT(name)
        // console.log('wikidataNameSparql = ' + wikidataNameSparql)
        submitQuery(wikidataNameSparql, wikidatanameHandler)
      }

      function submitQuery (sparql, resultsHandler) {
        console.log(sparql)
        var url =
          SparqlServer.queryEndpoint +
          '?query=' +
          encodeURIComponent(sparql) +
          '&output=json'

        doQuery(url, resultsHandler)
      }

      $(document).ready(function () {
        getClasses()

        $('#submit-button').click(function () {
          console.log($('#wikidata-name').val())
          getNamed($('#wikidata-name').val())
        })
        //
      })
    </script>
  </head>

  <body>
    <h2>Trev</h2>

    <form id="name-form">
      <label>Name:</label>
      <input type="text" id="wikidata-name" />
      <button type="button" id="submit-button">Submit</button>
    </form>

    <p id="links"></p>
  </body>
</html>
