<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Trev</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- link rel="icon" type="image/png" sizes="48x48" href="favicon.png" / -->

    <link rel="stylesheet" href="css/two-column.css" />
    <link rel="stylesheet" href="css/trev.css" />

    <script src="js/lib/jquery-3.6.0.min.js"></script>

    <script src="js/config.js"></script>

    <script src="js/utils-old.js"></script>
    <script src="js/sparql-connector-old.js"></script>

    <script src="js/sparql-templates.js"></script>
    <script src="js/html-templates.js"></script>

    <script type="text/javascript" language="javascript">
      function makeList (linkArray) {
        var list = '<ul>'

        for (var i = 0; i < linkArray.length; i++) {
          console.log('linkArray[i] = ' + JSON.stringify(linkArray[i]))
          list += linkHT(linkArray[i])
        }

        return list + '</ul>'
      }

      function listInstances (klass) {
        submitQuery(instancesQT(klass), instancesHandler)
      }

      function instancesHandler (json) {
        var bindings = json.results.bindings
        console.log('INSTANCES' + JSON.stringify(bindings))

        var instances = []
        for (var i = 0; i < bindings.length; i++) {
          let url = bindings[i].instance.value

          instances.push(url)
        }

        var list = makeList(instances)
        $('#instances').replaceWith(list)
      }

      function classesHandler (json) {
        var bindings = json.results.bindings
        console.log(JSON.stringify(bindings))

        var classes = []
        for (var i = 0; i < bindings.length; i++) {
          //  links.push({ link: bindings[i].link.value })
          let label = bindings[i].label.value
          let url = bindings[i].class.value
          classes[label] = url
        }

        // var list = makeList(links)
        // $('#links').replaceWith(list)
        populateClassesMenu(classes)
      }

      function populateClassesMenu (classes) {
        var $dropdown = $('#classesDropdown')
        for (var key in classes) {
          console.log('pop ' + key)
          var option = $('<option />')
          option.attr('value', classes[key])
          $dropdown.append(option.text(key))
        }
      }

      function getClasses () {
        submitQuery(classesQT(), classesHandler)
      }

      function submitQuery (sparql, resultsHandler) {
        console.log(sparql)
        var url =
          SparqlServer.queryEndpoint +
          '?query=' +
          encodeURIComponent(sparql) +
          '&output=json'

        doQuery(url, resultsHandler)
      }

      $(document).ready(function () {
        getClasses()

        $('#submit-button').click(function () {
          console.log($('#wikidata-name').val())
          getNamed($('#wikidata-name').val())
        })

        $('#classesDropdown').change(function () {
          const klass = $('#classesDropdown').val()
          console.log('classesDropdown has changed' + klass)
          listInstances(klass)
        })
        //
      })
    </script>
  </head>

  <body>
    <div class="main">
      <h2>Trev</h2>

      <div class="navbar">
        <a href="https://hyperdata.it">hyperdata.it</a>
      </div>

      <div class="row">
        <div class="column">
          <h3>left</h3>

          <p id="instances" />
        </div>

        <div class="column">
          <h3>right</h3>
          <form id="add-instance">
            <fieldset id="fields">
              <legend>Add Instance</legend>

              <label for="classesDropdown">Class</label>
              <select name="classesDropdown" id="classesDropdown"></select>

              <label for="url">URL</label>
              <input id="url" type="text" />

              <!--
        <label for="description">Description</label>
        <textarea class="description" id="description">this is b3</textarea>
        <label for="tags">Tags</label>
        <input id="tags" type="text" value="tag1, tag2" />
        <label for="nick">Creator</label>
        <input id="nick" type="text" value="danja" />
        -->
            </fieldset>
            <button type="button" id="submit-button">Submit</button>
          </form>
          <p>
            <a href="https://hyperdata.it/xmlns/project/index.htm"
              >Project Vocabulary</a
            >
          </p>
        </div>
      </div>
    </div>
  </body>
  <script type="module" src="test/depot.test.js"></script>
</html>
